{"is_source_file": true, "format": "Python", "description": "Main application module for Price List Management Service using FastAPI, defining API endpoints for price and promotion management, including in-memory data stores, configuration loading, and health check.", "external_files": ["fastapi", "pydantic", "fastapi.middleware.cors", "os"], "external_methods": ["os.getenv", "fastapi.FastAPI", "fastapi.HTTPException", "fastapi.Query", "fastapi.middleware.cors.CORSMiddleware", "pydantic.BaseModel", "pydantic.Field"], "published": ["app", "get_settings", "health"], "classes": [{"name": "PriceCreate", "description": "Schema for creating or updating product base price"}, {"name": "PriceResponse", "description": "Schema for returning price information with optional promotion details"}, {"name": "PromotionUpsert", "description": "Schema for creating or updating promotion discounts"}, {"name": "PriceQuery", "description": "Schema for querying product prices with optional promotion application"}], "methods": [{"name": "Dict[str,Any] get_settings()", "description": "Loads service settings from environment variables", "scope": "", "scopeKind": ""}, {"name": "health()", "description": "Endpoint for health/liveness check", "scope": "", "scopeKind": ""}, {"name": "upsert_price(payload: PriceCreate)", "description": "Creates or updates the price for a product and computes final price considering current promotions", "scope": "", "scopeKind": ""}, {"name": "get_price(product_id: str, apply_promotions: bool = Query(True, description=\"Whether to apply active promotions\"))", "description": "Retrieves the current price for a specific product, optionally applying promotions", "scope": "", "scopeKind": ""}, {"name": "query_price(payload: PriceQuery)", "description": "Queries product price with specified currency and promotion inclusion", "scope": "", "scopeKind": ""}, {"name": "upsert_promotion(payload: PromotionUpsert)", "description": "Creates or updates a promotion for a product", "scope": "", "scopeKind": ""}], "calls": ["os.getenv", "app.add_middleware", "PRICES.__setitem__", "PROMOTIONS.get", "PriceResponse", "HTTPException", "PRICES.get", "PriceResponse", "PriceResponse", "PriceResponse", "PriceResponse", "PROMOTIONS.__setitem__"], "search-terms": ["PriceListManagementService", "PriceCreate", "PriceResponse", "PromotionUpsert", "PriceQuery", "FastAPI", "Health", "promotions", "prices", "app", "Promotion"], "state": 2, "file_id": 2, "knowledge_revision": 5, "git_revision": "", "ctags": [{"_type": "tag", "name": "PRICES", "path": "/home/kavia/workspace/code-generation/e-commerce-store-11176-11410/PriceListManagementService/app/main.py", "pattern": "/^PRICES: Dict[str, Dict[str, Any]] = {}  # key: product_id, value: dict with base price and curre/", "language": "Python", "typeref": "typename:Dict[str, Dict[str, Any]]", "kind": "variable"}, {"_type": "tag", "name": "PROMOTIONS", "path": "/home/kavia/workspace/code-generation/e-commerce-store-11176-11410/PriceListManagementService/app/main.py", "pattern": "/^PROMOTIONS: Dict[str, float] = {}  # key: product_id, value: percent discount (0-100)$/", "language": "Python", "typeref": "typename:Dict[str, float]", "kind": "variable"}, {"_type": "tag", "name": "PriceCreate", "path": "/home/kavia/workspace/code-generation/e-commerce-store-11176-11410/PriceListManagementService/app/main.py", "pattern": "/^class PriceCreate(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "PriceQuery", "path": "/home/kavia/workspace/code-generation/e-commerce-store-11176-11410/PriceListManagementService/app/main.py", "pattern": "/^class PriceQuery(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "PriceResponse", "path": "/home/kavia/workspace/code-generation/e-commerce-store-11176-11410/PriceListManagementService/app/main.py", "pattern": "/^class PriceResponse(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "PromotionUpsert", "path": "/home/kavia/workspace/code-generation/e-commerce-store-11176-11410/PriceListManagementService/app/main.py", "pattern": "/^class PromotionUpsert(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "allow_origins", "path": "/home/kavia/workspace/code-generation/e-commerce-store-11176-11410/PriceListManagementService/app/main.py", "pattern": "/^allow_origins = [o.strip() for o in settings[\"ALLOWED_ORIGINS\"].split(\",\")] if settings[\"ALLOWED/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "app", "path": "/home/kavia/workspace/code-generation/e-commerce-store-11176-11410/PriceListManagementService/app/main.py", "pattern": "/^app = FastAPI($/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "base_price", "path": "/home/kavia/workspace/code-generation/e-commerce-store-11176-11410/PriceListManagementService/app/main.py", "pattern": "/^    base_price: float = Field(..., description=\"Base price before discounts\")$/", "language": "Python", "typeref": "typename:float", "kind": "variable", "scope": "PriceCreate", "scopeKind": "class"}, {"_type": "tag", "name": "base_price", "path": "/home/kavia/workspace/code-generation/e-commerce-store-11176-11410/PriceListManagementService/app/main.py", "pattern": "/^    base_price: float = Field(..., description=\"Base price\")$/", "language": "Python", "typeref": "typename:float", "kind": "variable", "scope": "PriceResponse", "scopeKind": "class"}, {"_type": "tag", "name": "currency", "path": "/home/kavia/workspace/code-generation/e-commerce-store-11176-11410/PriceListManagementService/app/main.py", "pattern": "/^    currency: str = Field(..., description=\"ISO currency code\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "PriceCreate", "scopeKind": "class"}, {"_type": "tag", "name": "currency", "path": "/home/kavia/workspace/code-generation/e-commerce-store-11176-11410/PriceListManagementService/app/main.py", "pattern": "/^    currency: str = Field(..., description=\"ISO currency code\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "PriceQuery", "scopeKind": "class"}, {"_type": "tag", "name": "currency", "path": "/home/kavia/workspace/code-generation/e-commerce-store-11176-11410/PriceListManagementService/app/main.py", "pattern": "/^    currency: str = Field(..., description=\"ISO currency code\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "PriceResponse", "scopeKind": "class"}, {"_type": "tag", "name": "final_price", "path": "/home/kavia/workspace/code-generation/e-commerce-store-11176-11410/PriceListManagementService/app/main.py", "pattern": "/^    final_price: float = Field(..., description=\"Final price with promotions applied\")$/", "language": "Python", "typeref": "typename:float", "kind": "variable", "scope": "PriceResponse", "scopeKind": "class"}, {"_type": "tag", "name": "get_price", "path": "/home/kavia/workspace/code-generation/e-commerce-store-11176-11410/PriceListManagementService/app/main.py", "pattern": "/^async def get_price(product_id: str, apply_promotions: bool = Query(True, description=\"Whether t/", "language": "Python", "kind": "function", "signature": "(product_id: str, apply_promotions: bool = Query(True, description=\"Whether to apply active promotions\"))"}, {"_type": "tag", "name": "get_settings", "path": "/home/kavia/workspace/code-generation/e-commerce-store-11176-11410/PriceListManagementService/app/main.py", "pattern": "/^def get_settings() -> Dict[str, Any]:$/", "language": "Python", "typeref": "typename:Dict[str,Any]", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "health", "path": "/home/kavia/workspace/code-generation/e-commerce-store-11176-11410/PriceListManagementService/app/main.py", "pattern": "/^async def health():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "include_promotions", "path": "/home/kavia/workspace/code-generation/e-commerce-store-11176-11410/PriceListManagementService/app/main.py", "pattern": "/^    include_promotions: bool = Field(True, description=\"Apply promotions if available\")$/", "language": "Python", "typeref": "typename:bool", "kind": "variable", "scope": "PriceQuery", "scopeKind": "class"}, {"_type": "tag", "name": "percent_off", "path": "/home/kavia/workspace/code-generation/e-commerce-store-11176-11410/PriceListManagementService/app/main.py", "pattern": "/^    percent_off: float = Field(..., ge=0, le=100, description=\"Percent discount 0-100\")$/", "language": "Python", "typeref": "typename:float", "kind": "variable", "scope": "PromotionUpsert", "scopeKind": "class"}, {"_type": "tag", "name": "product_id", "path": "/home/kavia/workspace/code-generation/e-commerce-store-11176-11410/PriceListManagementService/app/main.py", "pattern": "/^    product_id: str = Field(..., description=\"Product id\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "PriceCreate", "scopeKind": "class"}, {"_type": "tag", "name": "product_id", "path": "/home/kavia/workspace/code-generation/e-commerce-store-11176-11410/PriceListManagementService/app/main.py", "pattern": "/^    product_id: str = Field(..., description=\"Product id\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "PriceQuery", "scopeKind": "class"}, {"_type": "tag", "name": "product_id", "path": "/home/kavia/workspace/code-generation/e-commerce-store-11176-11410/PriceListManagementService/app/main.py", "pattern": "/^    product_id: str = Field(..., description=\"Product id\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "PriceResponse", "scopeKind": "class"}, {"_type": "tag", "name": "product_id", "path": "/home/kavia/workspace/code-generation/e-commerce-store-11176-11410/PriceListManagementService/app/main.py", "pattern": "/^    product_id: str = Field(..., description=\"Product id\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "PromotionUpsert", "scopeKind": "class"}, {"_type": "tag", "name": "promotion_applied", "path": "/home/kavia/workspace/code-generation/e-commerce-store-11176-11410/PriceListManagementService/app/main.py", "pattern": "/^    promotion_applied: Optional[float] = Field(None, description=\"Percent discount applied if an/", "language": "Python", "typeref": "typename:Optional[float]", "kind": "variable", "scope": "PriceResponse", "scopeKind": "class"}, {"_type": "tag", "name": "query_price", "path": "/home/kavia/workspace/code-generation/e-commerce-store-11176-11410/PriceListManagementService/app/main.py", "pattern": "/^async def query_price(payload: PriceQuery):$/", "language": "Python", "kind": "function", "signature": "(payload: PriceQuery)"}, {"_type": "tag", "name": "settings", "path": "/home/kavia/workspace/code-generation/e-commerce-store-11176-11410/PriceListManagementService/app/main.py", "pattern": "/^settings = get_settings()$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "upsert_price", "path": "/home/kavia/workspace/code-generation/e-commerce-store-11176-11410/PriceListManagementService/app/main.py", "pattern": "/^async def upsert_price(payload: PriceCreate):$/", "language": "Python", "kind": "function", "signature": "(payload: PriceCreate)"}, {"_type": "tag", "name": "upsert_promotion", "path": "/home/kavia/workspace/code-generation/e-commerce-store-11176-11410/PriceListManagementService/app/main.py", "pattern": "/^async def upsert_promotion(payload: PromotionUpsert):$/", "language": "Python", "kind": "function", "signature": "(payload: PromotionUpsert)"}], "hash": "ee671dfbaf66569fb85027af96a45d85", "format-version": 4, "code-base-name": "PriceListManagementService", "filename": "PriceListManagementService/app/main.py", "fields": [{"name": "Dict[str, Dict[str, Any]] PRICES", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Dict[str, float] PROMOTIONS", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "allow_origins = [o.strip() for o in settings[\"ALLOWED_ORIGINS\"].split(\",\")] if settings[\"ALLOWED/", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "app = FastAPI(", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "float base_price", "scope": "PriceCreate", "scopeKind": "class", "description": "unavailable"}, {"name": "str currency", "scope": "PriceCreate", "scopeKind": "class", "description": "unavailable"}, {"name": "float final_price", "scope": "PriceResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "bool include_promotions", "scope": "PriceQuery", "scopeKind": "class", "description": "unavailable"}, {"name": "float percent_off", "scope": "PromotionUpsert", "scopeKind": "class", "description": "unavailable"}, {"name": "str product_id", "scope": "PriceCreate", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[float] promotion_applied", "scope": "PriceResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "settings = get_settings()", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"5": ""}]}